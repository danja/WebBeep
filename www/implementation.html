<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta http-equiv="content-type" content="text/html; charset=us-ascii">
  <title>Web Beep : text to tones and back again</title>
  <meta name="description" content="Web Beep : text to tones and back again">
  <meta name="author" content="Danny Ayers">
  <link rel="shortcut icon" href="/favicon.ico">
  <!-- M$ etc -->
  <link rel="apple-touch-icon" href="/apple-icon.png">
  <!-- iDespair -->
  <link rel="icon" type="image/png" href="/apple-icon.png">
  <!-- HTML5 -->
  <link rel="stylesheet" href="fonts/font.css" type="text/css" media="Screen">
  <link rel="stylesheet" href="css/tabs.css" type="text/css" media="screen">
  <link rel="stylesheet" href="css/stuff.css" type="text/css" media="Screen">
  <script type="text/javascript" src="js/curvycorners.js">
 </script>
</head>

<body id="tab1">
<ul id="topnav">
  <li class="xtab1"><a href="/" title="Danny Ayers' Blog">Raw Blog</a> </li>
  <li class="xtab2"><a href="http://hyperdata.org/danja/"
    title="my updates on various social sites">Planet Danja</a> </li>
  <li class="xtab3"><a href="http://hyperdata.org/planet/"
    title="stuff I'm watching">Planet Raw</a> </li>
  <li class="xtab4"><a href="http://hyperdata.org/"
    title="Linked Data related material">hyperdata.org</a> </li>
  <li class="xtab5"><a href="http://hyperdata.org/wiki/"
    title="on my personal wiki">Stuff</a> </li>
  <li class="xtab6"><a href="http://hyperdata.org/xmlns/"
    title="various namespaces/ontologies">Vocabs</a> </li>
  <li class="xtab7"><a href="http://dannyayers.com/about.html"
    title="About">About</a> </li>
</ul>
<br>


<div id="header">
<h1 id="page-title"><a href="index.html">Web Beep</a></h1>

<p id="description">how it works</p>
</div>

<div class="container">

<div class="sidebar-left">
<h3>Contents</h3>
<ul>
  <li><a href="#Design">Design</a></li>
  <li><a href="#Encoding">Encoding</a></li>
  <li><a href="#Decoding">Decoding</a></li>
  <li><a href="#Initial">Implementation</a></li>
  <li><a href="#Notes">Notes</a></li>
</ul>
</div>

<div class="container">

<div class="sidebar-right">
<h3>Nearby</h3>
<ul>
  <li><a href="index.html">Home</a> </li>
  <li><a href="spec.html">Specification</a></li>
</ul>

<h3><a name="Reference" id="Reference">Reference</a></h3>
<ul>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
</ul>

<h3>Elsewhere</h3>
<ul>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
  <li><a href="#">Link</a> </li>
</ul>
</div>

<div class="content">
<h1>Introduction</h1>

<p>This write-up is rough &amp; ready, mostly I wanted notes for myself,
offboard memory. But however incoherent, hopefully it contains enough
information to explain how this thing works. </p>

<p>There is some digital signal processing jargon, but DSP can just be treated
as black-box stuff, there's really <strong>no need to go into the detailed
maths to build things</strong>. (It's been many years since I last worked on
stuff like this and my maths is totally rusted, the revision I did for this was
mostly skimming Wikipedia - see <a href="#Reference">Reference</a> links). </p>

<h1><a id="Design">Design Considerations</a></h1>

<p>The original idea was to encode HTTP URLs as little tunes, with the
characters in URLs <em>somehow</em> mapping to musical notes. It's essentially
the same idea as used in <a
href="http://en.wikipedia.org/wiki/Touch_tone">touch-tone</a> phone signals,
but tweaked to make the beeps easier on the ear. </p>

<h2>Text Processing</h2>

<p>International coverage (i.e. <a
href="http://en.wikipedia.org/wiki/Internationalized_Resource_Identifier">IRI</a>s)
is fairly essential, which basically means supporting <strong><a
href="http://en.wikipedia.org/wiki/Unicode">Unicode</a></strong>. Because of
this it was decided not to include any optimisations or other special features
for URLs, and simply support <strong>arbitrary text</strong>. Unicode contains
a <em>lot</em> of characters, and mapping from these to musical pitches
directly is almost certainly unfeasible. However <a
href="http://en.wikipedia.org/wiki/Punycode">Punycode</a> is an encoding syntax
by which a string of Unicode characters can be transformed uniquely and
reversibly into a much smaller character set. Basically it's <strong>a mapping
to ASCII</strong>. Roughly speaking, characters that can be expressed in ASCII
are expressed that way, but multiple ASCII characters are used to represent
other individual Unicode characters. In general, the cost of reducing the size
of the character set is an increase in the resulting string length. </p>

<h2>Phonic Constraints</h2>

<p>To achieve a reasonable compromise between length of (beep) messages,
musicality and implementation complexity, it was decided that a <strong>maximum
of two concurrent tones</strong> (one bass, one treble) was probably most
suitable. By restricting these to a <strong><a
href="http://en.wikipedia.org/wiki/Pentatonic">pentatonic scale</a></strong>,
arbitrary combinations of notes could be used without major dissonance. Another
consideration was that generic hardware should be able to transmit and receive
the beeps, so a range of pitches was chosen that should be suitable for common
electroacoustic transducers, i.e. nothing too low or too high (approx.
250-1500Hz, which is around female speech range and a bit higher, or an
extended soprano singer). The restriction to the notes of the pentatonic scale
(i.e. 5 per octave) meant a little more space for data was desirable, so the
treble notes may appear as half- or whole-length.</p>

<p>This may give the impression a lot of planning went into this aspect : not
really, most decisions were made during experimentation, based on what sounded
about right.</p>

<h1><a id="Encoding">Encoding</a></h1>

<p>Generating Web Beeps is relatively straightforward, details of the
requirements can be found in the <a href="spec.html">specification</a>, there's
an example of how this may be implemented in Java in the <a
href="https://github.com/danja/WebBeep">source code</a>.</p>

<h1><a id="Decoding">Decoding</a></h1>

<p>Getting the text back out from the beeps is rather more convoluted (<em>hee
hee</em>), though is based on standard digital signal processing (<a
href="http://en.wikipedia.org/wiki/Digital_signal_processing">DSP</a>)
techniques. </p>

<h2>block diagram</h2>

<h2>Pitch Detection</h2>

<p>A crucial step in getting data back from mixed-up tones.</p>

<h2>Pitch Detection</h2>

<p>Many pitch detection algorithms are available, here are some examples ranked
in order of guesstimated suitability:</p>
<ol>
  <li>Cross-correlation (against reference waves) : should be the most accurate
    and efficient</li>
  <li>Pisarenko decomposition : can take advantage of prior knowledge (there
    are max 2 tones)</li>
  <li>FFT : brute force, computationally expensive (lots of irrelevant
    cross-correlation) but very well known and easy to see what's going on</li>
  <li>Bandpass filters (one per note) : could maybe be good, as a variation of
    1, need to figure out what to convolve</li>
  <li>Zero-crossing detection/timing : likely to be unreliable</li>
</ol>

<p>Performance shouldn't really be a problem on a PC-like machine or even a
smartphone, though experimentation needed. For accuracy it'd be nice to have
(say) 3 parallel decoding algorithms going, let them vote for the best match.
</p>

<h1><a id="Initial">Implementation</a></h1>

<p>The reference implementation has been written in Java. </p>

<p>Generating signals is pretty easy, but manipulating them can get hard. So I
assumed I'd need to use a piece of kit like Octave (very like Matlab, only open
source). But as I got into it, it turned out to be straightforward, given the
material available on the Web. </p>

<p>For an internal representation of signals I started with a
<code>List&lt;Double&gt;</code>, expecting to have to turn everything over to
arrays at some point for performance (arrays give me a headache, always
out-by-one). That point didn't arrive, although I've had to translate to/from
arrays here and there for interfacing with libs. Long live Collections!</p>

<h2>Visualization</h2>

<p>I started by playing with generated tones in Audacity, passing them to and
from code as .wav files. Very clunky - it quickly became obvious there was
something I needed above anything else: a simple way of visualizing signals.</p>

<p>Scales and offsets are always a pain, but it didn't take that long to get
something together that was usable: </p>

<p><img alt="test tone plot" src="images/correlation-tone-plot.png" width="800"
height="200"></p>

<p>Plotter.java - a little bit of Swing which takes a List&lt;Double&gt; and
jams it in the window.</p>

<h4>FFT Detection</h4>

<p>The decoder was first developed using FFT for pitch detection - a suitable
FFT class was easily found online (a direct port of a C version). A peak
detector (to identify the peaks in the power spectrum delivered by the FFT) was
also needed. After several unsatisfying experiments I found a public domain
peak detector. The FFT+peak detector setup basically worked but proved very
sensitive to noise and distortion. The code for this is still in the
repository, it's handy having FFT around for spectrum analysis.</p>

<h4>Pre- and Post-Processing</h4>

<p>Normalisation (before &amp; after chunking)</p>

<p>Filtering (before &amp; after chunking)</p>

<p>reduce harmonic distorion artifacts and out-of-band noise</p>

<p>Although some </p>

<h4>Cross-correlation Blind Alley</h4>

<p>So I tried a second approach, experimenting with cross-correlation. My
intuition said there <em>must</em> be some way of correlating individual
reference tone sine waves with the Beep signals. Rather than run through every
frequency, as in FFT, just pick the ones of interest, the ones known to have
been used in generating the signal. </p>

<p><strong>Goertzel</strong></p>

<p>After wasting loads of time of this, I remembered the close similarity
between the encoding here and the encoding of DTFM signals. How's that usually
done? Turns out that there's an algorithm that in effect does the kind of
known-freq correlation thing I was looking for. It goes by the name of
Goertzel. What's more it's remarkable simple - </p>

<p>plus peak detection</p>

<p><em>timing</em></p>

<h4>Cross-Correlation</h4>

<p>The second approach to pitch detection I tried was cross-correlation, the
idea being to have reference tones corresponding to all the note frequencies
that are likely to be present, and comparing each of these with a given chunk
in the Web Beep. Intuitively, this should rock - it's totally targetted and so
should be very accurate and efficient.</p>

<h1><a id="Notes">Notes</a></h1>

<h2></h2>

<h3>Applications</h3>

<p>As a kind of QR Code for the ear, Web Beeps should be useful in a lot of
places. <em>Suggestions please...</em></p>

<p>Ring Tone - use your email, Home Page or personal URI.</p>

<p></p>

<h2>Patent Pending?</h2>

<p><strong>No. </strong><strong><a
href="http://en.swpat.org/wiki/Blocking_innovation_and_research">Software
patents hurt innovation</a>.</strong></p>

<p>In any case, I'm sure many variations of this have been done before, though
it's hard to find out what there is. Searches I've tried mostly led to
something related to mobile/cellphone ringtones (grr, I wanted the name "Web
Tone" but it's already taken).</p>

<p>The basic idea is fairly trivial: what if you had something like DTFM tones
only not so hard on the ear? Given that, implementations are pretty obvious
given minimal background knowledge of character encoding, music and DSP. Simple
matter of guesswork, experimentation &amp; banging out the code. The
implementation described here is pretty arbitrary, mostly based on what seemed
like a good idea at the time.</p>

<p><a href="https://github.com/danja/WebBeep">Please clone the project.</a></p>

<div id="footer">
<p>(c) <a href="http://dannyayers.com">Danny Ayers</a> </p>

<p>This work is licensed for reuse <br>
<a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative
Commons</a> <a rel="license"
href="http://creativecommons.org/licenses/by/3.0/"><br>
<img alt="Creative Commons License" style="border-width:0"
src="http://i.creativecommons.org/l/by/3.0/88x31.png"></a><br>
</p>
</div>
</div>
</div>
</div>
</body>
</html>
